<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lockdown Timer</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%;
    display: flex; flex-direction: column;
    justify-content: center; align-items: center;
    background: #111;
    color: #eee;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    overflow: hidden;
  }
  #container {
    text-align: center;
    transition: opacity 0.4s ease;
  }
  label {
    font-size: 1.5rem;
    margin-right: 0.5rem;
    user-select: none;
  }
  input[type=number] {
    font-size: 2.5rem;
    width: 7rem;
    padding: 0.3em 0.5em;
    border: none;
    border-radius: 12px;
    text-align: center;
    background: #2d1a33;
    color: #f8bbd0;
    box-shadow: 0 0 6px #f48fb1;
    outline: none;
    transition: box-shadow 0.3s ease;
  }
  input[type=number]:focus {
    box-shadow: 0 0 10px #f06292;
    background: #3e2a48;
  }
  button {
    font-size: 2rem;
    margin-left: 1rem;
    padding: 0.3em 1.2em;
    border-radius: 12px;
    border: none;
    background: #f06292;
    color: white;
    cursor: pointer;
    user-select: none;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #ec407a;
  }
  #countdown {
    font-size: 7rem;
    margin-top: 2rem;
    user-select: none;
  }
  #warning {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(255, 0, 0, 0.9);
    color: white;
    padding: 2rem;
    border-radius: 15px;
    font-size: 2rem;
    text-align: center;
    z-index: 9999;
    display: none;
    box-shadow: 0 0 50px rgba(255, 0, 0, 0.8);
  }
</style>
</head>
<body>
<div id="container">
  <label for="minutes">Set time (minutes):</label>
  <input id="minutes" type="number" min="1" max="120" value="5" />
  <button id="startBtn">Start</button>
</div>
<div id="countdown" style="display:none;">00:00</div>
<div id="warning">
  <div>‚ö†Ô∏è LOCKDOWN ACTIVE ‚ö†Ô∏è</div>
  <div style="font-size: 1.2rem; margin-top: 1rem;">You cannot exit until timer ends!</div>
</div>

<script>
  const startBtn = document.getElementById('startBtn');
  const minutesInput = document.getElementById('minutes');
  const countdownEl = document.getElementById('countdown');
  const container = document.getElementById('container');
  const warningEl = document.getElementById('warning');
  let countdownInterval;
  let endTime;
  let isLockdownActive = false;
  let forceFullscreenInterval;
  let originalTitle = document.title;
  
  // Store timer state in sessionStorage to persist across tabs
  function saveTimerState() {
    if (isLockdownActive) {
      sessionStorage.setItem('lockdownEndTime', endTime.toString());
      sessionStorage.setItem('lockdownActive', 'true');
    }
  }
  
  function loadTimerState() {
    const savedEndTime = sessionStorage.getItem('lockdownEndTime');
    const savedActive = sessionStorage.getItem('lockdownActive');
    
    if (savedActive === 'true' && savedEndTime) {
      const savedEnd = parseInt(savedEndTime);
      const now = Date.now();
      
      if (savedEnd > now) {
        // Resume timer
        endTime = savedEnd;
        isLockdownActive = true;
        container.style.display = 'none';
        countdownEl.style.display = 'block';
        requestFullscreen();
        startCountdown(0, true); // Resume mode
        enableLockdownMode();
      } else {
        // Timer already ended
        clearLockdownState();
      }
    }
  }
  
  function clearLockdownState() {
    sessionStorage.removeItem('lockdownEndTime');
    sessionStorage.removeItem('lockdownActive');
    isLockdownActive = false;
  }

  function formatTime(s) {
    const m = Math.floor(s / 60).toString().padStart(2, '0');
    const sec = (s % 60).toString().padStart(2, '0');
    return `${m}:${sec}`;
  }
  
  function requestFullscreen() {
    const el = document.documentElement;
    if (!document.fullscreenElement) {
      if (el.requestFullscreen) el.requestFullscreen().catch(() => {});
      else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
      else if (el.msRequestFullscreen) el.msRequestFullscreen();
    }
  }
  
  function showWarning() {
    warningEl.style.display = 'block';
    setTimeout(() => {
      warningEl.style.display = 'none';
    }, 2000);
  }
  
  function enableLockdownMode() {
    isLockdownActive = true;
    
    // Continuously try to maintain fullscreen
    forceFullscreenInterval = setInterval(() => {
      if (isLockdownActive && !document.fullscreenElement) {
        requestFullscreen();
        showWarning();
      }
    }, 500);
    
    // Block common exit methods
    document.addEventListener('keydown', blockExitKeys);
    document.addEventListener('contextmenu', blockContextMenu);
    window.addEventListener('beforeunload', blockPageUnload);
    window.addEventListener('blur', handleWindowBlur);
    
    // Change page title to indicate lockdown
    document.title = "üîí LOCKDOWN ACTIVE - " + originalTitle;
  }
  
  function disableLockdownMode() {
    isLockdownActive = false;
    clearInterval(forceFullscreenInterval);
    clearLockdownState();
    
    // Remove event listeners
    document.removeEventListener('keydown', blockExitKeys);
    document.removeEventListener('contextmenu', blockContextMenu);
    window.removeEventListener('beforeunload', blockPageUnload);
    window.removeEventListener('blur', handleWindowBlur);
    
    // Restore original title
    document.title = originalTitle;
  }
  
  function blockExitKeys(e) {
    if (!isLockdownActive) return;
    
    // Block F11, Escape, Alt+F4, Ctrl+W, Ctrl+T, etc.
    const blockedKeys = ['F11', 'Escape'];
    const blockedCombos = [
      e.ctrlKey && (e.key === 'w' || e.key === 'W'),
      e.ctrlKey && (e.key === 't' || e.key === 'T'),
      e.ctrlKey && e.shiftKey && (e.key === 'T' || e.key === 't'),
      e.altKey && e.key === 'F4',
      e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'i'), // Dev tools
      e.key === 'F12' // Dev tools
    ];
    
    if (blockedKeys.includes(e.key) || blockedCombos.some(combo => combo)) {
      e.preventDefault();
      e.stopPropagation();
      showWarning();
      requestFullscreen();
    }
  }
  
  function blockContextMenu(e) {
    if (isLockdownActive) {
      e.preventDefault();
      showWarning();
    }
  }
  
  function blockPageUnload(e) {
    if (isLockdownActive) {
      saveTimerState();
      // Try to open a new tab with the same page (limited by popup blockers)
      try {
        const newWindow = window.open(window.location.href, '_blank');
        if (newWindow) {
          newWindow.focus();
        }
      } catch (err) {
        // Popup blocked, but we saved the state
      }
      
      e.preventDefault();
      e.returnValue = 'Timer is still running! Are you sure you want to exit?';
      return e.returnValue;
    }
  }
  
  function handleWindowBlur() {
    if (isLockdownActive) {
      setTimeout(() => {
        window.focus();
        requestFullscreen();
      }, 100);
    }
  }

  function startCountdown(durationMinutes, resumeMode = false) {
    clearInterval(countdownInterval);
    
    if (!resumeMode) {
      endTime = Date.now() + durationMinutes * 60 * 1000;
    }
    
    saveTimerState();
    countdownEl.style.display = 'block';
    
    countdownInterval = setInterval(() => {
      const secondsLeft = Math.round((endTime - Date.now()) / 1000);
      if (secondsLeft <= 0) {
        clearInterval(countdownInterval);
        countdownEl.textContent = "00:00";
        disableLockdownMode();
        
        // Exit fullscreen
        if (document.exitFullscreen) {
          document.exitFullscreen();
        } else if (document.webkitExitFullscreen) {
          document.webkitExitFullscreen();
        } else if (document.msExitFullscreen) {
          document.msExitFullscreen();
        }
        
        alert("Time's up! You can exit now.");
        
        // Reset UI
        setTimeout(() => {
          container.style.display = 'block';
          container.style.opacity = 1;
          countdownEl.style.display = 'none';
        }, 1000);
      } else {
        countdownEl.textContent = formatTime(secondsLeft);
        saveTimerState(); // Update state periodically
      }
    }, 250);
  }

  startBtn.addEventListener('click', () => {
    const mins = parseInt(minutesInput.value);
    if (isNaN(mins) || mins < 1 || mins > 120) {
      alert('Please enter a number between 1 and 120');
      return;
    }
    
    container.style.opacity = 0;
    setTimeout(() => {
      container.style.display = 'none';
      requestFullscreen();
      enableLockdownMode();
      startCountdown(mins);
    }, 400);
  });

  // Handle fullscreen changes
  document.addEventListener('fullscreenchange', () => {
    if (!document.fullscreenElement && isLockdownActive && countdownEl.textContent !== "00:00") {
      setTimeout(() => {
        requestFullscreen();
        showWarning();
      }, 100);
    }
  });
  
  document.addEventListener('webkitfullscreenchange', () => {
    if (!document.webkitFullscreenElement && isLockdownActive && countdownEl.textContent !== "00:00") {
      setTimeout(() => {
        requestFullscreen();
        showWarning();
      }, 100);
    }
  });

  // Load any existing timer state when page loads
  window.addEventListener('load', loadTimerState);
  
  // Handle page visibility changes
  document.addEventListener('visibilitychange', () => {
    if (document.visibilityState === 'visible' && isLockdownActive) {
      requestFullscreen();
    }
  });
  
  // Prevent drag and drop
  document.addEventListener('dragover', e => {
    if (isLockdownActive) e.preventDefault();
  });
  
  document.addEventListener('drop', e => {
    if (isLockdownActive) e.preventDefault();
  });
</script>
</body>
</html>
